<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PELITA PRABU SIDOARJO - GIS HUB FULL VERSION</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: white; overflow-x: hidden; }
        
        /* Layout Map */
        #map { height: 650px; width: 100%; border-radius: 2.5rem; transition: all 0.5s ease; }
        
        /* Efek Glassmorphism Mewah */
        .glass-card { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.05); }
        .glass-nav { background: rgba(15, 23, 42, 0.5); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* Custom Ikon Marker */
        .marker-school { 
            background-image: url('https://cdn-icons-png.flaticon.com/512/8074/8074788.png'); 
            background-size: cover; width: 35px; height: 35px; cursor: pointer; filter: drop-shadow(0 0 5px #2563eb);
        }
        .marker-kitchen { 
            background-image: url('https://cdn-icons-png.flaticon.com/512/3448/3448099.png'); 
            background-size: cover; width: 42px; height: 42px; cursor: pointer; filter: drop-shadow(0 0 10px #22c55e); 
        }

        /* Popup Mapbox Styling */
        .mapboxgl-popup-content { color: #000; border-radius: 20px; padding: 20px; font-weight: 600; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        /* Scrollbar Sidebar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 10px; }
        
        /* EFEK LOGO GLOW */
        .logo-container { 
            filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.6)); 
            transition: all 0.3s ease;
        }
        .logo-container:hover {
            filter: drop-shadow(0 0 25px rgba(34, 197, 94, 0.9));
            transform: scale(1.05);
        }
    </style>
</head>
<body class="antialiased">

    <nav class="max-w-[1550px] mx-auto p-6 flex justify-between items-center glass-nav sticky top-0 z-[1000] mb-4">
        <div class="flex items-center gap-6">
            <div class="logo-container">
                <img src="pelitaprabu.png" alt="Logo Pelita Prabu" class="h-20 w-20 object-contain">
            </div>
            <div>
                <h1 class="text-2xl font-black tracking-tighter uppercase leading-tight">PELITA PRABU <span class="text-green-500 italic">SIDOARJO</span></h1>
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-[0.4em] flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> GIS & Supply Chain Hub v3.5
                </p>
            </div>
        </div>
        <div class="flex gap-4 items-center">
            <div class="hidden md:block bg-slate-900 border border-slate-800 px-4 py-2 rounded-2xl text-[10px] font-bold">
                WAKTU SISTEM: <span id="clock" class="text-green-500">00:00:00</span>
            </div>
            <button onclick="togglePerspective()" class="bg-white/5 hover:bg-white/10 border border-white/10 px-6 py-2.5 rounded-full text-[10px] font-bold transition uppercase tracking-widest">2D/3D View</button>
            <button onclick="open360()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2.5 rounded-full text-[10px] font-bold transition shadow-xl shadow-blue-600/20 uppercase tracking-widest italic">Inspection 360°</button>
        </div>
    </nav>

    <main class="max-w-[1550px] mx-auto p-6 space-y-6">
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="glass-card p-6 rounded-[2rem] border-l-4 border-green-500 shadow-lg">
                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest mb-1">Total Porsi Disalurkan</p>
                <div class="flex items-baseline gap-2">
                    <h2 class="text-4xl font-black">15.840</h2>
                    <span class="text-green-500 text-xs">▲ 12%</span>
                </div>
            </div>
            <div class="glass-card p-6 rounded-[2rem] border-l-4 border-blue-500 shadow-lg">
                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest mb-1">Unit Sekolah Aktif</p>
                <h2 class="text-4xl font-black text-blue-400">847</h2>
            </div>
            <div class="glass-card p-6 rounded-[2rem] border-l-4 border-yellow-500 shadow-lg">
                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest mb-1">Bahan Baku Lokal</p>
                <h2 class="text-4xl font-black text-yellow-500">87%</h2>
            </div>
            <div class="glass-card p-6 rounded-[2rem] border-l-4 border-purple-500 shadow-lg">
                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest mb-1">Status Sistem</p>
                <h2 class="text-4xl font-black text-green-400">OPTIMAL</h2>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            
            <div class="space-y-6">
                <div class="glass-card p-6 rounded-[2.5rem] border-t-4 border-green-500 text-slate-200">
                    <h3 class="text-[11px] font-black text-green-500 mb-5 uppercase tracking-[0.2em] flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-ping"></span> Dapur Utama Operasional
                    </h3>
                    <div id="kitchen-list" class="space-y-3 mb-8"></div>
                    
                    <h3 class="text-[11px] font-black text-blue-400 mb-5 uppercase tracking-[0.2em] flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span> Unit Sekolah Penerima
                    </h3>
                    <div id="school-list" class="space-y-3 max-h-[450px] overflow-y-auto pr-2 text-sm"></div>
                </div>
            </div>

            <div class="xl:col-span-3 relative">
                <div id='map' class="shadow-2xl border border-white/5 bg-slate-900"></div>
                
                <div class="absolute bottom-8 right-8 w-80 glass-card p-6 rounded-[2.5rem] border border-white/10 z-[500] shadow-2xl">
                    <p class="text-[10px] font-bold text-green-500 mb-4 uppercase tracking-widest italic">Smart Nutrition Calculator</p>
                    <div class="space-y-4">
                        <select id="food-select" onchange="calculate()" class="w-full bg-slate-950 border border-slate-800 text-[11px] p-3.5 rounded-2xl focus:outline-none focus:border-green-500 text-white cursor-pointer">
                            <option value="350|25|10">MENU 1: Nasi Bandeng Presto Sidoarjo</option>
                            <option value="320|20|12">MENU 2: Nasi Ayam Krian Special</option>
                            <option value="280|15|8">MENU 3: Nasi Telur Tarik Bergizi</option>
                        </select>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="bg-slate-950/80 p-3 rounded-2xl border border-white/5 text-center">
                                <p class="text-[8px] text-gray-500 uppercase font-bold mb-1">Kkal</p>
                                <span id="total-cal" class="font-black text-green-400 text-sm">0</span>
                            </div>
                            <div class="bg-slate-950/80 p-3 rounded-2xl border border-white/5 text-center">
                                <p class="text-[8px] text-gray-500 uppercase font-bold mb-1">Prot</p>
                                <span id="total-prot" class="font-black text-blue-400 text-sm">0</span>
                            </div>
                            <div class="bg-slate-950/80 p-3 rounded-2xl border border-white/5 text-center">
                                <p class="text-[8px] text-gray-500 uppercase font-bold mb-1">Fat</p>
                                <span id="total-fat" class="font-black text-yellow-500 text-sm">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-360" class="hidden fixed inset-0 z-[9999] bg-black/95 flex items-center justify-center p-6">
        <div class="w-full max-w-5xl glass-card rounded-[3.5rem] overflow-hidden relative border border-white/10 shadow-[0_0_50px_rgba(0,0,0,1)]">
            <button onclick="close360()" class="absolute top-8 right-8 bg-red-600 hover:bg-red-500 w-12 h-12 rounded-full z-[10001] font-bold shadow-xl transition-all active:scale-90 flex items-center justify-center text-white">X</button>
            <div class="aspect-video">
                <iframe width="100%" height="100%" frameborder="0" style="border:0" src="http://googleusercontent.com/maps.google.com/6" allowfullscreen></iframe>
            </div>
            <div class="p-8 text-center bg-slate-900 text-slate-200">
                <h4 class="font-black text-xl text-green-500 uppercase tracking-tighter">PELITA PRABU VIRTUAL INSPECTION</h4>
                <p class="text-[10px] text-slate-500 mt-2 uppercase tracking-[0.5em] font-bold">Transparansi Dapur & Pengiriman Sidoarjo</p>
            </div>
        </div>
    </div>

    <script>
        // TOKEN MAPBOX ANDA
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWRlbnNldHlvOTEiLCJhIjoiY21qcng1NGNkNGs3bzNpb3dwN2F4d21iMiJ9.HuxCF8jOGISuEBdyjOJznw';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: [112.63, -7.42], 
            zoom: 10.7,
            pitch: 45,
            bearing: -5
        });

        // 1. DATA DAPUR UTAMA
        const kitchens = [
            { name: "Dapur Utama Krian", coords: [112.5852, -7.4021], cap: "5000 Porsi" },
            { name: "Dapur Satelit Tarik", coords: [112.5186, -7.4641], cap: "2500 Porsi" },
            { name: "Dapur Sukodono", coords: [112.6732, -7.4042], cap: "3000 Porsi" },
            { name: "Dapur Pusat Sidoarjo", coords: [112.7183, -7.4478], cap: "8000 Porsi" }
        ];

        // 2. DATA SEKOLAH LENGKAP
        const schools = [
            { name: "SDN Magersari 1", coords: [112.7214, -7.4521], porsi: 450, kec: "Sidoarjo Kota" },
            { name: "SDN Buduran 2", coords: [112.7245, -7.4289], porsi: 380, kec: "Buduran" },
            { name: "SDN Candi 1", coords: [112.7138, -7.4812], porsi: 520, kec: "Candi" },
            { name: "SDN Waru 1", coords: [112.7302, -7.3521], porsi: 610, kec: "Waru" },
            { name: "SDN Krian 1", coords: [112.5890, -7.4050], porsi: 450, kec: "Krian" },
            { name: "SMPN 1 Tarik", coords: [112.5150, -7.4680], porsi: 620, kec: "Tarik" },
            { name: "SDN Sukodono 2", coords: [112.6700, -7.4080], porsi: 380, kec: "Sukodono" },
            { name: "SDN Balongbendo", coords: [112.5400, -7.3900], porsi: 400, kec: "Balongbendo" }
        ];

        let is3D = true;
        function togglePerspective() {
            if (is3D) { map.easeTo({ pitch: 0, bearing: 0 }); is3D = false; }
            else { map.easeTo({ pitch: 45, bearing: -5 }); is3D = true; }
        }

        map.on('load', () => {
            // RENDER DAPUR
            kitchens.forEach(k => {
                const el = document.createElement('div'); el.className = 'marker-kitchen';
                new mapboxgl.Marker(el).setLngLat(k.coords)
                    .setPopup(new mapboxgl.Popup({offset: 30}).setHTML(`
                        <div style="font-family:Plus Jakarta Sans; padding:5px;">
                            <p style="color:#16a34a; font-weight:800; font-size:10px; text-transform:uppercase; margin-bottom:4px;">DAPUR PELITA PRABU</p>
                            <h4 style="font-size:16px; font-weight:800; margin:0;">${k.name}</h4>
                            <p style="font-size:11px; color:#666; margin-top:5px;">Kapasitas: <b>${k.cap}</b></p>
                        </div>
                    `))
                    .addTo(map);
                
                document.getElementById('kitchen-list').innerHTML += `
                    <div class="p-4 bg-green-500/5 border border-green-500/10 rounded-2xl flex justify-between items-center hover:bg-green-500/15 transition-all cursor-pointer group" onclick="map.flyTo({center: [${k.coords}], zoom: 15})">
                        <div>
                            <p class="text-[12px] font-black group-hover:text-green-400 text-white">${k.name}</p>
                            <p class="text-[9px] text-green-400 font-bold italic">${k.cap}</p>
                        </div>
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    </div>`;
            });

            // RENDER SEKOLAH
            schools.forEach(s => {
                const el = document.createElement('div'); el.className = 'marker-school';
                new mapboxgl.Marker(el).setLngLat(s.coords)
                    .setPopup(new mapboxgl.Popup({offset: 25}).setHTML(`
                        <div style="font-family:Plus Jakarta Sans; padding:5px;">
                            <p style="color:#2563eb; font-weight:800; font-size:10px; text-transform:uppercase; margin-bottom:4px;">UNIT PENERIMA MBG</p>
                            <h4 style="font-size:15px; font-weight:800; margin:0;">${s.name}</h4>
                            <div style="margin-top:10px; padding:8px; background:#f0fdf4; border-radius:10px; text-align:center;">
                                <span style="color:#16a34a; font-weight:900; font-size:14px;">${s.porsi} PORSI</span>
                            </div>
                        </div>
                    `))
                    .addTo(map);

                document.getElementById('school-list').innerHTML += `
                    <div class="p-4 bg-white/5 border border-white/5 rounded-2xl hover:bg-white/10 cursor-pointer transition flex justify-between items-center shadow-sm text-slate-200" onclick="map.flyTo({center: [${s.coords}], zoom: 15})">
                        <div>
                            <p class="font-bold text-xs">${s.name}</p>
                            <p class="text-[9px] text-slate-500 uppercase font-black">${s.kec}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs font-black text-blue-400">${s.porsi}</p>
                            <p class="text-[8px] text-slate-600 font-bold uppercase">PORSI</p>
                        </div>
                    </div>`;
            });
        });

        function calculate() {
            const val = document.getElementById('food-select').value.split('|');
            document.getElementById('total-cal').innerText = val[0];
            document.getElementById('total-prot').innerText = val[1] + 'g';
            document.getElementById('total-fat').innerText = val[2] + 'g';
        }
        function open360() { document.getElementById('modal-360').classList.remove('hidden'); }
        function close360() { document.getElementById('modal-360').classList.add('hidden'); }
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
        calculate();
    </script>
</body>
</html>