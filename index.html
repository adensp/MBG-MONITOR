<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PELITA PRABU SIDOARJO - GLOBAL GIS HUB MASTER</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEQzL5fTW9CILJ3_A27t_HfX9ZpRXwV2E&libraries=streetView"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: white; overflow-x: hidden; }
        
        #map { height: 650px; width: 100%; border-radius: 2.5rem; transition: all 0.5s ease; border: 1px solid rgba(255,255,255,0.1); }
        #sv-container { height: 100%; width: 100%; border-radius: 2rem; background: #000; }

        /* Glassmorphism Design */
        .glass-card { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.05); }
        .glass-nav { background: rgba(15, 23, 42, 0.5); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        /* Logo Glow h-20 w-20 */
        .logo-container { filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.6)); transition: all 0.3s ease; }
        .logo-container:hover { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(34, 197, 94, 0.9)); }

        /* Custom Pins */
        .marker-school { background-image: url('https://cdn-icons-png.flaticon.com/512/8074/8074788.png'); background-size: cover; width: 35px; height: 35px; cursor: pointer; filter: drop-shadow(0 0 8px #2563eb); }
        .marker-kitchen { background-image: url('https://cdn-icons-png.flaticon.com/512/3448/3448099.png'); background-size: cover; width: 42px; height: 42px; cursor: pointer; filter: drop-shadow(0 0 12px #22c55e); }

        .mapboxgl-popup-content { color: #000; border-radius: 18px; padding: 15px; font-weight: 600; }
        
        /* Nutrition Progress Bar */
        .prog-bar { height: 8px; border-radius: 4px; background: rgba(255,255,255,0.05); overflow: hidden; margin-top: 8px; }
        .prog-fill { height: 100%; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 10px; }
    </style>
</head>
<body class="antialiased">

    <nav class="max-w-[1600px] mx-auto p-6 flex justify-between items-center glass-nav sticky top-0 z-[1000] mb-6 rounded-[2.5rem] mt-4">
        <div class="flex items-center gap-6">
            <div class="logo-container">
                <img src="pelitaprabu.png" alt="Logo" class="h-20 w-20 object-contain">
            </div>
            <div>
                <h1 class="text-2xl font-black tracking-tighter uppercase leading-tight italic">PELITA PRABU <span class="text-green-500">SIDOARJO</span></h1>
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-[0.4em] flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> GIS HUB & DYNAMIC 360°
                </p>
            </div>
        </div>
        <div class="flex gap-4 items-center">
            <div class="hidden md:block bg-slate-900 border border-white/5 px-4 py-2 rounded-2xl text-[10px] font-bold">
                WAKTU: <span id="clock" class="text-green-500 font-mono">00:00:00</span>
            </div>
            <button onclick="togglePerspective()" class="bg-white/5 border border-white/10 px-6 py-2.5 rounded-full text-[10px] font-bold uppercase tracking-widest hover:bg-white/10 transition">2D/3D View</button>
            <button onclick="triggerLoc('Pusat Sidoarjo', -7.4478, 112.7183)" class="bg-blue-600 px-6 py-2.5 rounded-full text-[10px] font-bold shadow-xl shadow-blue-600/30 uppercase italic tracking-widest transition hover:bg-blue-700 font-black">Open 360 View</button>
        </div>
    </nav>

    <main class="max-w-[1600px] mx-auto p-6 grid grid-cols-1 xl:grid-cols-4 gap-8">
        
        <aside class="space-y-6">
            <div class="glass-card p-7 rounded-[3rem] border-t-4 border-green-500 h-fit">
                <h3 class="text-[11px] font-black text-green-500 mb-5 uppercase tracking-widest flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-ping"></span> Dapur Utama Operasional
                </h3>
                <div id="kitchen-list" class="space-y-3 mb-8"></div>
                
                <h3 class="text-[11px] font-black text-blue-400 mb-5 uppercase tracking-widest flex items-center gap-2">
                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span> Unit Sekolah Penerima
                </h3>
                <div id="school-list" class="space-y-3 max-h-[500px] overflow-y-auto pr-2 text-sm"></div>
            </div>
        </aside>

        <div class="xl:col-span-3 space-y-8">
            <div id='map' class="shadow-2xl bg-slate-900 border border-white/5"></div>

            <div class="glass-card p-10 rounded-[3.5rem] border border-white/10 shadow-2xl">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-black text-green-500 italic uppercase tracking-tighter">Kalkulator  Nutrisi  Cerdas</h3>
                    <div class="flex gap-4">
                        <div class="text-center px-4 border-r border-white/10">
                            <p class="text-[9px] text-gray-500 uppercase font-black">Fat (g)</p>
                            <span id="total-fat" class="text-xl font-bold text-yellow-500">0</span>
                        </div>
                        <div class="text-center px-4">
                            <p class="text-[9px] text-gray-500 uppercase font-black">Carbs (g)</p>
                            <span id="total-carb" class="text-xl font-bold text-purple-500">0</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="space-y-4">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Menu Pokok:</label>
                        <select id="food-select" onchange="calculate()" class="w-full bg-slate-950 border border-slate-800 p-4 rounded-2xl text-xs font-bold text-white focus:border-green-500 outline-none transition-all">
                            <option value="350|25|10|45">Menu 1: Nasi Bandeng Presto</option>
                            <option value="380|28|15|48">Menu 2: Nasi Daging Sapi Lada Hitam</option>
                            <option value="410|30|18|40">Menu 3: Nasi Rawon Sidoarjo</option>
                            <option value="320|22|12|42">Menu 4: Nasi Ayam Krian Nutrisi</option>
                            <option value="300|20|8|55">Menu 5: Nasi Telur Balado Organik</option>
                            <option value="450|35|20|50">Menu 6: Nasi Rendang Daging Sapi</option>
                        </select>
                    </div>

                    <div class="space-y-4">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Ekstra & Porsi:</label>
                        <div class="flex gap-2">
                            <select id="extra-select" onchange="calculate()" class="w-1/2 bg-slate-950 border border-slate-800 p-4 rounded-2xl text-[10px] font-bold text-white outline-none">
                                <option value="0|0|0|0">None Extra</option>
                                <option value="150|8|5|12">Susu UHT</option>
                                <option value="90|1|0|23">Pisang Ambon</option>
                                <option value="70|6|5|1">Telur Rebus</option>
                            </select>
                            <select id="portion-select" onchange="calculate()" class="w-1/2 bg-slate-950 border border-slate-800 p-4 rounded-2xl text-[10px] font-bold text-white uppercase">
                                <option value="1">SD</option>
                                <option value="1.4">SMP</option>
                                <option value="0.7">TK</option>
                            </select>
                        </div>
                    </div>

                    <div class="bg-slate-950 p-6 rounded-[2.5rem] border border-white/5 space-y-4 shadow-inner">
                        <div>
                            <p class="text-[9px] text-gray-500 uppercase font-black">Energi</p>
                            <span id="total-cal" class="text-3xl font-black text-green-400 font-mono">0</span> <small class="text-xs">Kkal</small>
                            <div class="prog-bar"><div id="cal-bar" class="prog-fill bg-green-500" style="width: 0%"></div></div>
                        </div>
                        <div>
                            <p class="text-[9px] text-gray-500 uppercase font-black">Protein</p>
                            <span id="total-prot" class="text-3xl font-black text-blue-400 font-mono">0</span> <small class="text-xs">g</small>
                            <div class="prog-bar"><div id="prot-bar" class="prog-fill bg-blue-500" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-360" class="hidden fixed inset-0 z-[9999] bg-black/95 flex items-center justify-center p-6">
        <div class="w-full max-w-6xl glass-card rounded-[4rem] h-[85vh] overflow-hidden relative border border-white/10 shadow-2xl">
            <button onclick="close360()" class="absolute top-8 right-8 bg-red-600 hover:bg-red-500 text-white w-14 h-14 rounded-full z-[10001] font-bold shadow-2xl transition hover:scale-110">X</button>
            <div id="sv-container" class="w-full h-full"></div>
            <div class="absolute bottom-0 inset-x-0 p-8 bg-slate-900/90 text-center backdrop-blur-md border-t border-white/5">
                <h4 id="sv-title" class="font-black text-2xl text-green-500 uppercase tracking-tighter italic italic">Street View Inspection</h4>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.5em]">PELITA PRABU SIDOARJO HUB • LIVE GOOGLE API</p>
            </div>
        </div>
    </div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWRlbnNldHlvOTEiLCJhIjoiY21qcng1NGNkNGs3bzNpb3dwN2F4d21iMiJ9.HuxCF8jOGISuEBdyjOJznw';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: [112.63, -7.42], 
            zoom: 10.7,
            pitch: 45,
            bearing: -5
        });

        const kitchens = [
            { name: "Dapur Utama Krian", coords: [112.5852, -7.4021], cap: "5000 Porsi" },
            { name: "Dapur Satelit Tarik", coords: [112.5186, -7.4641], cap: "2500 Porsi" },
            { name: "Dapur Sukodono", coords: [112.6732, -7.4042], cap: "3000 Porsi" },
            { name: "Dapur Pusat Sidoarjo", coords: [112.7183, -7.4478], cap: "8000 Porsi" }
        ];

        const schools = [
            { name: "SDN Magersari 1", coords: [112.7214, -7.4521], porsi: 450, kec: "Sidoarjo Kota" },
            { name: "SDN Buduran 2", coords: [112.7245, -7.4289], porsi: 380, kec: "Buduran" },
            { name: "SDN Candi 1", coords: [112.7138, -7.4812], porsi: 520, kec: "Candi" },
            { name: "SDN Waru 1", coords: [112.7302, -7.3521], porsi: 610, kec: "Waru" },
            { name: "SDN Krian 1", coords: [112.5890, -7.4050], porsi: 450, kec: "Krian" },
            { name: "SMPN 1 Tarik", coords: [112.5150, -7.4680], porsi: 620, kec: "Tarik" },
            { name: "SDN Sukodono 2", coords: [112.6700, -7.4080], porsi: 380, kec: "Sukodono" },
            { name: "SDN Balongbendo", coords: [112.5400, -7.3900], porsi: 400, kec: "Balongbendo" }
        ];

        map.on('load', () => {
            kitchens.forEach(k => {
                const el = Object.assign(document.createElement('div'), {className: 'marker-kitchen'});
                new mapboxgl.Marker(el).setLngLat(k.coords).addTo(map);
                el.onclick = () => triggerLoc(k.name, k.coords[1], k.coords[0]);
                
                document.getElementById('kitchen-list').innerHTML += `
                    <div class="p-4 bg-green-500/5 border border-green-500/10 rounded-2xl flex justify-between items-center cursor-pointer hover:bg-green-500/15 transition-all" onclick="triggerLoc('${k.name}',${k.coords[1]},${k.coords[0]})">
                        <div>
                            <p class="text-[12px] font-black text-white">${k.name}</p>
                            <p class="text-[9px] text-green-400 font-bold italic">${k.cap}</p>
                        </div>
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    </div>`;
            });

            schools.forEach(s => {
                const el = Object.assign(document.createElement('div'), {className: 'marker-school'});
                new mapboxgl.Marker(el).setLngLat(s.coords).setPopup(new mapboxgl.Popup({offset: 25}).setHTML(`<b>${s.name}</b><br>${s.porsi} Porsi`)).addTo(map);
                el.onclick = () => triggerLoc(s.name, s.coords[1], s.coords[0]);

                document.getElementById('school-list').innerHTML += `
                    <div class="p-4 bg-white/5 border border-white/5 rounded-2xl flex justify-between items-center cursor-pointer hover:bg-white/10 transition" onclick="triggerLoc('${s.name}',${s.coords[1]},${s.coords[0]})">
                        <div><p class="text-xs font-bold text-white">${s.name}</p><p class="text-[9px] text-gray-500 uppercase font-black">${s.kec}</p></div>
                        <b class="text-blue-400 text-xs">${s.porsi}</b>
                    </div>`;
            });
        });

        function triggerLoc(name, lat, lng) {
            map.flyTo({ center: [lng, lat], zoom: 17, speed: 1.5 });
            document.getElementById('modal-360').classList.remove('hidden');
            document.getElementById('sv-title').innerText = name;
            // GOOGLE STREET VIEW INIT
            new google.maps.StreetViewPanorama(document.getElementById("sv-container"), {
                position: { lat: lat, lng: lng },
                pov: { heading: 165, pitch: 0 },
                zoom: 1,
                visible: true
            });
        }

        function calculate() {
            const f = document.getElementById('food-select').value.split('|');
            const e = document.getElementById('extra-select').value.split('|');
            const m = parseFloat(document.getElementById('portion-select').value);

            const cal = (parseFloat(f[0]) + parseFloat(e[0])) * m;
            const pro = (parseFloat(f[1]) + parseFloat(e[1])) * m;
            const fat = (parseFloat(f[2]) + parseFloat(e[2])) * m;
            const carb = (parseFloat(f[3] || 45) + parseFloat(e[3] || 0)) * m;

            document.getElementById('total-cal').innerText = Math.round(cal);
            document.getElementById('total-prot').innerText = Math.round(pro);
            document.getElementById('total-fat').innerText = Math.round(fat);
            document.getElementById('total-carb').innerText = Math.round(carb);
            
            document.getElementById('cal-bar').style.width = Math.min((cal / 850 * 100), 100) + "%";
            document.getElementById('prot-bar').style.width = Math.min((pro / 50 * 100), 100) + "%";
        }

        function close360() { document.getElementById('modal-360').classList.add('hidden'); }
        function togglePerspective() { map.easeTo({ pitch: map.getPitch() === 0 ? 45 : 0 }); }
        function openDef() { triggerLoc('Sidoarjo Pusat', -7.4478, 112.7183); }
        
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
        calculate();
    </script>
</body>
</html>
